# Gemini.md

## 0. 前提（言語）

- 回答・作業記述は **日本語** で行うこと

---

## 1. プロジェクト概要（重要制約）

以下は **絶対遵守**。

### 1.1 ポート（変更禁止）

- フロントエンド: `http://localhost:3000`（**3000固定**）
- バックエンドAPI: `http://localhost:8000`（**8000固定**）
- **いかなる理由でもポート番号を変更しない**（提案も禁止）

### 1.2 バックエンド設計（FastAPI / Pydantic）

- バックエンドAPIは **FastAPI**
- リクエスト/レスポンスのスキーマは **Pydanticモデル** を使用
    - dict のまま入出力を扱う実装は禁止

### 1.3 フロントエンド設計（Tailwind優先）

- スタイリングは **Tailwind CSS を優先**
- Tailwindで表現できるのに、同等のCSSを重複定義しない（重複スタイル禁止）

### 1.4 環境変数（.env）

- `.env` のキーは **UPPER_SNAKE_CASE**
- `.env` の値に **クォートを付けない**

### 1.5 コンテキスト制御（Antigravity：最重要）

#### 目的

- `node_modules/` 等の **巨大・自動生成物** によるコンテキスト汚染（トークン浪費/誤推論/遅延）を防ぎ、必要なコードだけを根拠に実装する。

#### ルール（必須）

1. **`.geminiignore` を必ず使う（一次ソース）**

- プロジェクトルートに `.geminiignore` を作成し、Antigravity/Gemini のツールが参照する「コンテキスト除外」を定義する。
    - `.geminiignore` は `.gitignore` に近い記法（glob、`/`、`!` 等）でパターン指定できる。
    - 変更を反映するには、セッション再起動が必要な場合がある。

1. **除外対象は “探索/列挙/読込/共有” しない**

- `.geminiignore` に入れたパスは、原則として **list / read / search / attach（@共有）** の対象にしない。
    - 例外は「ユーザーが明示的に、その除外対象を読む理由と範囲を指定した場合」のみ。
    - 例外時も **必要最小ファイル** だけを扱い、ディレクトリ丸ごと読みはしない。

1. **実装差異があっても運用で防ぐ**

- 環境/ツールの実装差異により、`.geminiignore` に入っていても “明示アクセス” が可能なケースが報告されている。
    - その場合でも本ルールに従い、除外対象は原則触れない（必要ならユーザーに理由と範囲を提示し、明示許可を得る）。

#### 推奨 `.geminiignore`（ベースライン）

- 以下は「典型的にコンテキストに不要なもの」の例。リポジトリ事情に合わせて増減してよい。

# Dependencies / build artifacts

**/node_modules/
**/.next/
**/dist/
**/build/
**/out/
**/coverage/

---

## 2. Commands（実行コマンドの最小セット）

※サービス名や具体コマンドは `docker-compose.yml` / `package.json` / `pyproject.toml` 等の定義に合わせること。

### 2.2 フロントエンド（例）

- 依存/起動/検証はリポジトリ定義に準拠
- **`npm run build` は実行しない（禁止）**

---

## 3. Code style / Architecture（規約）

### 3.1 UI

- Tailwindを第一選択とし、スタイルの重複を避ける
- コンポーネント分割は差分が最小になる粒度を優先（大改修は避ける）

### 3.2 API

- FastAPI + Pydantic の型境界を明確化（入力・出力モデルを定義）
- スキーマの変更は「既存クライアントへの影響」をPRに明記

### 3.3 ファイル追加と除外（GitHub / Antigravity）

- 作成したファイルが **GitHubに上げるべきでない** と判断した場合は、必ず `.gitignore` に追加する
- **Antigravity（AIコンテキスト）観点の除外は `.geminiignore` を正とする**
- 併せて、必要に応じて `.cursorignore` 等でインデックス除外し、コンテキストノイズを減らす

---

## 4. Workflow（作業の進め方）

- **一度に大改修しない**。小さく刻み「常に動く状態」を維持する
- 仕様が曖昧な場合は、先に **受け入れ基準（期待I/O、画面状態、エラー時挙動）** を文章化してから実装
- 可能なら、最小のテストや再現手順を先に用意（失敗→成功の順で確認）
- 原則 **1タスク = 1PR**（差分を小さく保つ）
- 長期スレッドで混線する場合は、タスク単位で会話/作業を切り替える（成果物は参照で持ち込む）
- 機能を追加する際は、既存の機能に対して影響与えないようにしてください

---

## 修正機能追加の際の作業開始時・終了時に必ず実施すること。必ず毎回全てtodoに含めてください

- 以下の操作は作業開始時に必ず行ってください
    - **作業開始時**: 必ず専用ブランチを作成する（feat-<機能名>、fix-<修正内容>等）
    - **mainブランチでの直接作業は絶対禁止**: いかなる変更もmainブランチに直接コミットしない
- 以下を必ず作業終了時に実行してください。
    1. 作業内容をブランチにコミット。mainには絶対にマージさせないでください。

## 5. Verification（検証手順：Pass/Failが明確）

変更後、最低限以下を満たすこと。

### 5.1 起動確認（ポート固定）

- フロント: `http://localhost:3000` にアクセスできる
- バックエンド: `http://localhost:8000` でlistenしている
    - FastAPI の `/docs` が表示できる（またはプロジェクト既定のヘルスチェックが200）

### 5.2 テスト

- 変更範囲に対して最短で効くテストを優先し、成功すること
- 同じテストを4回失敗した場合は、一度そのことを人間に報告してテストを中止して

---

## 6. ポート競合時の対処（3000 / 8000）

- 3000/8000 が使用中で起動失敗する場合は、**ポートは変えず**、該当プロセスを特定して終了する

---

## 7. Git運用（タスク終了時の必須手順）

### 7.1 add

- タスク終了時は必ず全ファイルを add: `git add -A`

### 7.2 commit（メッセージ要件）

- コミットメッセージ本文に **変更内容のサマリ** を箇条書き等で記載する

---

## 9. Security / Safety（安全運用）

- AIが提案するコマンドは **必ず人間がレビューしてから実行**
- 危険操作につながる手順は原則禁止・要注意
- 秘密情報が混入しうるファイルは **作成時点で除外（.gitignore/.geminiignore）** し、コミットしない

---

## 10. Rulesの分割運用（肥大化対策）

ルールは役割で分割管理し、焦点を狭く保つ（推奨）

---

## TODO（必須項目を含めること）

- [ ] ブランチ作成
- [ ] 実装
- [ ] 実装内容のテスト
- [ ] `git add -A`
- [ ] コミット（本文に変更サマリを記載）
